import{d as L,r as _,h as q,k as R,a1 as g,U as n,L as l,b as t,N as e,aS as F,X as V,K as c,Y as W,Z as x,P as B,a0 as u,V as r,Q as I,M as P,R as y,a2 as U,a4 as G,a5 as K,O as pe,a3 as E,S as z,aG as Y,aT as me,aU as Z,aV as fe,_ as S,$ as ke,T as ye,aH as _e,aW as be}from"./index-BsbnbFHs.js";import{R as he,a as A}from"./index-CRluOj6h.js";const we=[{id:"1",orderNumber:"GD-2023-001",quantity:100,status:"执行中",startTime:"2023-05-10 08:00:00",endTime:"2023-05-15 17:30:00",isUrgent:!0,remark:"客户急需，优先处理",customText:"特殊工艺要求：表面处理需细致",customNumber:1001,customDate:"2023-05-12",customImage:"https://via.placeholder.com/100",product:{id:"P1",productNumber:"CP-2023-001",productName:"高精度轴承",specification:"45×68×12mm",model:"HRB-6809Z",unit:"个",remark:"高精度静音轴承",customText:"特殊钢材",customNumber:9.8,customDate:"2023-05-01",customImage:"https://via.placeholder.com/100"}},{id:"2",orderNumber:"GD-2023-002",quantity:50,status:"未开始",startTime:"2023-05-16 08:00:00",endTime:"2023-05-20 17:30:00",isUrgent:!1,remark:"常规订单",customText:"包装要求：防潮处理",customNumber:1002,customDate:"2023-05-18",customImage:"https://via.placeholder.com/100",product:{id:"P2",productNumber:"CP-2023-002",productName:"液压阀门",specification:"DN25",model:"YF-25A",unit:"套",remark:"标准液压阀门",customText:"铜合金材质",customNumber:8.5,customDate:"2023-05-05",customImage:"https://via.placeholder.com/100"}},{id:"3",orderNumber:"GD-2023-003",quantity:200,status:"已结束",startTime:"2023-05-01 08:00:00",endTime:"2023-05-08 17:30:00",isUrgent:!1,remark:"已完成交付",customText:"质检要求：全检",customNumber:1003,customDate:"2023-05-07",customImage:"https://via.placeholder.com/100",product:{id:"P3",productNumber:"CP-2023-003",productName:"电路板组件",specification:"120×80mm",model:"PCB-A23",unit:"块",remark:"控制主板",customText:"FR-4材质",customNumber:7.6,customDate:"2023-04-25",customImage:"https://via.placeholder.com/100"}}],ge=[{id:"GX1",workOrderId:"1",name:"原料准备",planQuantity:100,completedQuantity:80,status:"执行中"},{id:"GX2",workOrderId:"1",name:"机加工",planQuantity:100,completedQuantity:60,status:"执行中"},{id:"GX3",workOrderId:"1",name:"组装",planQuantity:100,completedQuantity:0,status:"未开始"},{id:"GX4",workOrderId:"1",name:"检验",planQuantity:100,completedQuantity:0,status:"未开始"},{id:"GX5",workOrderId:"2",name:"原料准备",planQuantity:50,completedQuantity:0,status:"未开始"},{id:"GX6",workOrderId:"2",name:"机加工",planQuantity:50,completedQuantity:0,status:"未开始"},{id:"GX7",workOrderId:"3",name:"原料准备",planQuantity:200,completedQuantity:200,status:"已结束"},{id:"GX8",workOrderId:"3",name:"组装",planQuantity:200,completedQuantity:200,status:"已结束"}],Ce=[{id:"W1",name:"张三",workNumber:"SC001",department:"生产一部"},{id:"W2",name:"李四",workNumber:"SC002",department:"生产一部"},{id:"W3",name:"王五",workNumber:"SC003",department:"生产二部"},{id:"W4",name:"赵六",workNumber:"SC004",department:"生产二部"}],Ie=()=>new Promise(C=>{setTimeout(()=>{C(we)},500)}),Ne=C=>new Promise($=>{setTimeout(()=>{const a=ge.filter(d=>d.workOrderId===C);$(a)},300)}),Se=()=>new Promise(C=>{setTimeout(()=>{C(Ce)},300)}),$e={class:"selector-container"},Oe={class:"order-list"},Te={class:"order-item"},Qe={class:"order-id"},Ve={class:"order-product"},De={class:"order-status"},We=L({__name:"WorkOrderSelector",props:{visible:{type:Boolean}},emits:["update:visible","select"],setup(C,{emit:$}){const a=C,d=$,m=_(""),k=_([]),w=_(!1),O=q(()=>{if(!m.value)return k.value;const o=m.value.toLowerCase();return k.value.filter(v=>v.orderNumber.toLowerCase().includes(o)||v.product.productName.toLowerCase().includes(o))}),T=o=>{switch(o){case"未开始":return"default";case"执行中":return"primary";case"已结束":return"success";default:return"default"}},Q=()=>{d("update:visible",!1)},N=()=>{},b=async()=>{w.value=!0;try{k.value=await Ie()}catch(o){console.error("加载工单失败:",o)}finally{w.value=!1}},i=o=>{d("select",o),d("update:visible",!1)};return R(()=>a.visible,o=>{o&&b()}),(o,v)=>(u(),g(e(B),{show:o.visible,position:"bottom",style:{height:"70vh"},onClose:Q},{default:n(()=>[v[2]||(v[2]=l("div",{class:"popup-title"},"选择工单",-1)),l("div",$e,[t(e(F),{modelValue:m.value,"onUpdate:modelValue":v[0]||(v[0]=f=>m.value=f),placeholder:"搜索工单号或产品",onSearch:N},null,8,["modelValue"]),l("div",Oe,[t(e(V),null,{default:n(()=>[(u(!0),c(W,null,x(O.value,f=>(u(),g(e(r),{key:f.id,clickable:"",onClick:X=>i(f)},{default:n(()=>[l("div",Te,[l("div",Qe,[I(y(f.orderNumber)+" ",1),f.isUrgent?(u(),g(e(U),{key:0,type:"danger",class:"urgent-tag"},{default:n(()=>v[1]||(v[1]=[I(" 加急 ")])),_:1})):P("",!0)]),l("div",Ve,y(f.product.productName),1),l("div",De,[t(e(U),{type:T(f.status)},{default:n(()=>[I(y(f.status),1)]),_:2},1032,["type"])])])]),_:2},1032,["onClick"]))),128))]),_:1})])])]),_:1},8,["show"]))}}),Pe=G(We,[["__scopeId","data-v-1baca9f3"]]),qe={class:"selector-container"},xe={key:0,class:"no-data"},Ue={key:0,class:"loading-container"},Re={key:1,class:"no-data"},Le={key:2,class:"process-list"},Be={class:"process-item"},Ge={class:"process-name"},Xe={class:"process-quantity"},Ee={class:"process-status"},ze=L({__name:"ProcessSelector",props:{visible:{type:Boolean},workOrderId:{}},emits:["update:visible","select"],setup(C,{emit:$}){const a=C,d=$,m=_(""),k=_([]),w=_(!1),O=q(()=>{if(!m.value)return k.value;const o=m.value.toLowerCase();return k.value.filter(v=>v.name.toLowerCase().includes(o))}),T=o=>{switch(o){case"未开始":return"default";case"执行中":return"primary";case"已结束":return"success";default:return"default"}},Q=()=>{d("update:visible",!1)},N=()=>{},b=async()=>{if(!a.workOrderId){k.value=[];return}w.value=!0;try{k.value=await Ne(a.workOrderId)}catch(o){console.error("加载工序失败:",o)}finally{w.value=!1}},i=o=>{d("select",o),d("update:visible",!1)};return R(()=>a.workOrderId,o=>{o?b():k.value=[]}),R(()=>a.visible,o=>{o&&a.workOrderId&&b()}),(o,v)=>(u(),g(e(B),{show:o.visible,position:"bottom",style:{height:"70vh"},onClose:Q},{default:n(()=>[v[1]||(v[1]=l("div",{class:"popup-title"},"选择工序",-1)),l("div",qe,[o.workOrderId?(u(),c(W,{key:1},[t(e(F),{modelValue:m.value,"onUpdate:modelValue":v[0]||(v[0]=f=>m.value=f),placeholder:"搜索工序名称",onSearch:N},null,8,["modelValue"]),w.value?(u(),c("div",Ue,[t(e(K),{type:"spinner"})])):k.value.length===0?(u(),c("div",Re," 当前工单没有工序数据 ")):(u(),c("div",Le,[t(e(V),null,{default:n(()=>[(u(!0),c(W,null,x(O.value,f=>(u(),g(e(r),{key:f.id,clickable:"",onClick:X=>i(f)},{default:n(()=>[l("div",Be,[l("div",Ge,y(f.name),1),l("div",Xe," 计划数量: "+y(f.planQuantity)+" / 已完成: "+y(f.completedQuantity),1),l("div",Ee,[t(e(U),{type:T(f.status)},{default:n(()=>[I(y(f.status),1)]),_:2},1032,["type"])])])]),_:2},1032,["onClick"]))),128))]),_:1})]))],64)):(u(),c("div",xe," 请先选择工单 "))])]),_:1},8,["show"]))}}),Ae=G(ze,[["__scopeId","data-v-a29f4c78"]]),Fe={class:"selector-container"},Me={key:0,class:"loading-container"},He={key:1,class:"no-data"},Ye={key:2,class:"worker-list"},Ze={class:"worker-item"},Ke={class:"worker-name"},je={class:"worker-info"},Je={class:"department"},et=L({__name:"WorkerSelector",props:{visible:{type:Boolean}},emits:["update:visible","select"],setup(C,{emit:$}){const a=C,d=$,m=_(""),k=_([]),w=_(!1),O=q(()=>{if(!m.value)return k.value;const i=m.value.toLowerCase();return k.value.filter(o=>o.name.toLowerCase().includes(i)||o.workNumber.toLowerCase().includes(i))}),T=()=>{d("update:visible",!1)},Q=()=>{},N=async()=>{w.value=!0;try{k.value=await Se()}catch(i){console.error("加载生产人员失败:",i)}finally{w.value=!1}},b=i=>{d("select",i),d("update:visible",!1)};return R(()=>a.visible,i=>{i&&N()}),(i,o)=>(u(),g(e(B),{show:i.visible,position:"bottom",style:{height:"70vh"},onClose:T},{default:n(()=>[o[1]||(o[1]=l("div",{class:"popup-title"},"选择生产人员",-1)),l("div",Fe,[t(e(F),{modelValue:m.value,"onUpdate:modelValue":o[0]||(o[0]=v=>m.value=v),placeholder:"搜索姓名或工号",onSearch:Q},null,8,["modelValue"]),w.value?(u(),c("div",Me,[t(e(K),{type:"spinner"})])):k.value.length===0?(u(),c("div",He," 暂无生产人员数据 ")):(u(),c("div",Ye,[t(e(V),null,{default:n(()=>[(u(!0),c(W,null,x(O.value,v=>(u(),g(e(r),{key:v.id,clickable:"",onClick:f=>b(v)},{default:n(()=>[l("div",Ze,[l("div",Ke,y(v.name),1),l("div",je,[l("span",null,"工号: "+y(v.workNumber),1),l("span",Je,y(v.department),1)])])]),_:2},1032,["onClick"]))),128))]),_:1})]))])]),_:1},8,["show"]))}}),tt=G(et,[["__scopeId","data-v-e0736add"]]),st={class:"work-report"},lt={class:"page-container"},at={class:"select-section"},ot={class:"label-content"},ut={class:"label-right"},nt={key:0},rt={key:1,class:"placeholder"},it={class:"label-content"},dt={class:"label-right"},ct={key:0},vt={key:1,class:"placeholder"},pt={class:"label-content"},mt={class:"label-right"},ft={key:0},kt={key:1,class:"placeholder"},yt={class:"process-status"},_t=["disabled"],bt={key:0,class:"defect-tags"},ht={key:1},wt={key:1},gt={key:1},Ct={key:1},It={class:"defect-list"},Nt={class:"defect-name"},St={style:{"margin-top":"16px","text-align":"center"}},$t=L({__name:"WorkReport",setup(C){const $=ke(),a=_(null),d=_(null),m=_(null),k=_(null),w=_("未开始"),O=_(!1),T=_(!1),Q=_(!1),N=_(!1),b=_(null),i=_(null),o=_([]),v=q(()=>o.value.some(h=>h.quantity>0)),f=q(()=>o.value.reduce((h,s)=>h+(s.quantity||0),0)),X=h=>{switch(h){case"未开始":return"default";case"执行中":return"primary";case"已结束":return"success";default:return"default"}},j=h=>{switch(h.toLowerCase()){case"size":return"size";case"surface":return"surface";case"assembly":return"assembly";default:return"other"}},J=()=>{$.back()},ee=h=>{a.value=h,d.value=null},te=h=>{d.value=h,b.value=null,i.value=null,k.value=null},se=h=>{m.value=h},le=()=>{if(!a.value){S({message:"请先选择工单",position:"bottom"});return}T.value=!0},ae=()=>{if(!d.value){S({message:"请先选择工序",position:"bottom"});return}o.value.length===0&&(o.value=[{id:"1",name:"尺寸偏差",code:"SIZE",quantity:0},{id:"2",name:"表面缺陷",code:"SURFACE",quantity:0},{id:"3",name:"装配错误",code:"ASSEMBLY",quantity:0},{id:"4",name:"其他",code:"OTHER",quantity:0}]),N.value=!0},oe=()=>{(b.value||0)+(i.value||0)===0&&S({message:"良品数和不良品数至少填写一项",position:"bottom"}),(!i.value||i.value===0)&&(k.value=null),i.value&&i.value>0&&!k.value&&(N.value=!0)},M=()=>{i.value=f.value},ue=()=>{M(),N.value=!1},ne=()=>{if(!a.value){S({message:"请选择工单",position:"bottom"});return}if(!m.value){S({message:"请选择生产人员",position:"bottom"});return}if(!d.value){S({message:"请选择工序",position:"bottom"});return}if((b.value||0)+(i.value||0)<=0){S({message:"良品数和不良品数至少填写一项",position:"bottom"});return}if(i.value&&i.value>0&&!k.value){S({message:"请选择不良品原因",position:"bottom"});return}const s={workOrderId:a.value.id,processId:d.value.id,workerId:m.value.id,goodQuantity:b.value||0,defectQuantity:i.value||0,defectDetails:o.value.filter(D=>D.quantity>0).map(D=>({reasonId:D.id,quantity:D.quantity})),reportTime:new Date().toISOString()};console.log("提交数据:",s),S({type:"success",message:"报工提交成功",position:"bottom"}),d.value=null,b.value=null,i.value=null,o.value.forEach(D=>D.quantity=0)},re=()=>{a.value=null,d.value=null,b.value=null,i.value=null,k.value=null},ie=()=>{m.value=null},de=()=>{d.value=null,b.value=null,i.value=null,k.value=null},ce=h=>{S({message:`工序状态已切换为：${h}`,position:"bottom"})};return(h,s)=>{var H;const D=fe("van-button");return u(),c("div",st,[t(e(pe),{title:"报工","left-text":"返回","right-text":"提交",onClickLeft:J,onClickRight:ne}),l("div",lt,[s[20]||(s[20]=l("div",{class:"section-title"},"选择信息",-1)),l("div",at,[t(e(V),null,{default:n(()=>[t(e(r),{clickable:"",onClick:s[0]||(s[0]=p=>O.value=!0)},{title:n(()=>[l("div",ot,[s[8]||(s[8]=l("div",{class:"label-left"},[l("span",{class:"required-field"},"工单号")],-1)),l("div",ut,[a.value?(u(),c("span",nt,y(a.value.orderNumber),1)):(u(),c("span",rt,"点击选择工单")),a.value?(u(),g(e(z),{key:2,name:"clear",class:"clear-icon",onClick:E(re,["stop"])})):P("",!0)])])]),_:1}),t(e(r),{clickable:"",onClick:s[1]||(s[1]=p=>Q.value=!0)},{title:n(()=>[l("div",it,[s[9]||(s[9]=l("div",{class:"label-left"},[l("span",{class:"required-field"},"生产人员")],-1)),l("div",dt,[m.value?(u(),c("span",ct,y(m.value.name)+" ("+y(m.value.workNumber)+")",1)):(u(),c("span",vt,"点击选择生产人员")),m.value?(u(),g(e(z),{key:2,name:"clear",class:"clear-icon",onClick:E(ie,["stop"])})):P("",!0)])])]),_:1}),t(e(r),{clickable:"",onClick:le},{title:n(()=>[l("div",pt,[s[10]||(s[10]=l("div",{class:"label-left"},[l("span",{class:"required-field"},"工序名称")],-1)),l("div",mt,[d.value?(u(),c("span",ft,y(d.value.name),1)):(u(),c("span",kt,"点击选择工序")),d.value?(u(),g(e(z),{key:2,name:"clear",class:"clear-icon",onClick:E(de,["stop"])})):P("",!0)])])]),_:1})]),_:1})]),d.value?(u(),c(W,{key:0},[s[14]||(s[14]=l("div",{class:"section-title"},"报工提交信息",-1)),t(e(V),null,{default:n(()=>[t(e(r),{title:"任务数量（计划数/完成数）"},{default:n(()=>[I(y(d.value.planQuantity)+" / "+y(d.value.completedQuantity),1)]),_:1}),t(e(r),{title:"工序状态","title-style":{flex:"0 0 60px"}},{default:n(()=>[l("div",yt,[t(e(he),{modelValue:w.value,"onUpdate:modelValue":s[2]||(s[2]=p=>w.value=p),direction:"horizontal",onChange:ce},{default:n(()=>[t(e(A),{name:"未开始",class:"status-radio"},{default:n(()=>s[11]||(s[11]=[I("未开始")])),_:1}),t(e(A),{name:"执行中",class:"status-radio"},{default:n(()=>s[12]||(s[12]=[I("执行中")])),_:1}),t(e(A),{name:"已结束",class:"status-radio"},{default:n(()=>s[13]||(s[13]=[I("已结束")])),_:1})]),_:1},8,["modelValue"])])]),_:1}),t(e(r),{title:"报工数量"},{default:n(()=>[I(y(Number(b.value||0)+Number(i.value||0)),1)]),_:1}),t(e(r),{title:"良品数"},{default:n(()=>[Y(l("input",{"onUpdate:modelValue":s[3]||(s[3]=p=>b.value=p),type:"number",class:"input-field",placeholder:"请输入",disabled:!d.value,onInput:oe},null,40,_t),[[me,b.value]])]),_:1}),t(e(r),{title:"不良品数"},{default:n(()=>[l("button",{class:"defect-button",onClick:ae},y(v.value?"已选择"+f.value+"件":"请选择"),1)]),_:1}),t(e(r),{title:"不良品原因"},{default:n(()=>[v.value?(u(),c("div",bt,[(u(!0),c(W,null,x(o.value,p=>Y((u(),c("span",{key:p.id,class:ye(["defect-tag",j(p.code)])},y(p.name)+": "+y(p.quantity),3)),[[_e,p.quantity>0]])),128))])):(u(),c("span",ht,"无"))]),_:1})]),_:1})],64)):P("",!0),a.value?(u(),c(W,{key:1},[s[16]||(s[16]=l("div",{class:"section-title"},"工单信息",-1)),t(e(V),null,{default:n(()=>[t(e(r),{title:"工单数量",value:a.value.quantity},null,8,["value"]),t(e(r),{title:"工单状态"},{default:n(()=>[t(e(U),{type:X(a.value.status)},{default:n(()=>[I(y(a.value.status),1)]),_:1},8,["type"])]),_:1}),t(e(r),{title:"工单开始时间",value:a.value.startTime},null,8,["value"]),t(e(r),{title:"工单结束时间",value:a.value.endTime},null,8,["value"]),t(e(r),{title:"是否加急"},{default:n(()=>[a.value.isUrgent?(u(),g(e(U),{key:0,type:"danger"},{default:n(()=>s[15]||(s[15]=[I("加急")])),_:1})):(u(),c("span",wt,"否"))]),_:1}),t(e(r),{title:"备注",value:a.value.remark||"无"},null,8,["value"])]),_:1}),s[17]||(s[17]=l("div",{class:"section-title"},"工单自定义",-1)),t(e(V),null,{default:n(()=>[t(e(r),{title:"工单文本自定义",value:a.value.customText||"无"},null,8,["value"]),t(e(r),{title:"工单数字自定义",value:a.value.customNumber||"无"},null,8,["value"]),t(e(r),{title:"工单日期自定义",value:a.value.customDate||"无"},null,8,["value"]),t(e(r),{title:"工单图片自定义"},{default:n(()=>[a.value.customImage?(u(),g(e(Z),{key:0,src:a.value.customImage,width:"80",height:"80",fit:"cover"},null,8,["src"])):(u(),c("span",gt,"无"))]),_:1})]),_:1}),s[18]||(s[18]=l("div",{class:"section-title"},"产品信息",-1)),t(e(V),null,{default:n(()=>[t(e(r),{title:"产品编号",value:a.value.product.productNumber},null,8,["value"]),t(e(r),{title:"产品名称",value:a.value.product.productName},null,8,["value"]),t(e(r),{title:"规格",value:a.value.product.specification},null,8,["value"]),t(e(r),{title:"型号",value:a.value.product.model},null,8,["value"]),t(e(r),{title:"单位",value:a.value.product.unit},null,8,["value"]),t(e(r),{title:"产品备注",value:a.value.product.remark||"无"},null,8,["value"])]),_:1}),s[19]||(s[19]=l("div",{class:"section-title"},"产品自定义",-1)),t(e(V),null,{default:n(()=>[t(e(r),{title:"产品文本自定义",value:a.value.product.customText||"无"},null,8,["value"]),t(e(r),{title:"产品数字自定义",value:a.value.product.customNumber||"无"},null,8,["value"]),t(e(r),{title:"产品日期自定义",value:a.value.product.customDate||"无"},null,8,["value"]),t(e(r),{title:"产品图片自定义"},{default:n(()=>[a.value.product.customImage?(u(),g(e(Z),{key:0,src:a.value.product.customImage,width:"80",height:"80",fit:"cover"},null,8,["src"])):(u(),c("span",Ct,"无"))]),_:1})]),_:1})],64)):P("",!0)]),t(Pe,{visible:O.value,"onUpdate:visible":s[4]||(s[4]=p=>O.value=p),onSelect:ee},null,8,["visible"]),t(Ae,{visible:T.value,"onUpdate:visible":s[5]||(s[5]=p=>T.value=p),"work-order-id":(H=a.value)==null?void 0:H.id,onSelect:te},null,8,["visible","work-order-id"]),t(tt,{visible:Q.value,"onUpdate:visible":s[6]||(s[6]=p=>Q.value=p),onSelect:se},null,8,["visible"]),t(e(B),{show:N.value,"onUpdate:show":s[7]||(s[7]=p=>N.value=p),position:"bottom",round:""},{default:n(()=>[l("div",It,[(u(!0),c(W,null,x(o.value,p=>(u(),c("div",{key:p.id,class:"defect-item"},[l("span",Nt,y(p.name),1),t(e(be),{modelValue:p.quantity,"onUpdate:modelValue":ve=>p.quantity=ve,min:0,onChange:M},null,8,["modelValue","onUpdate:modelValue"])]))),128)),l("div",St,[t(D,{type:"primary",block:"",onClick:ue},{default:n(()=>s[21]||(s[21]=[I("确定")])),_:1})])])]),_:1},8,["show"])])}}}),Qt=G($t,[["__scopeId","data-v-84d12dae"]]);export{Qt as default};
